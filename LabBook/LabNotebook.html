<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Heavy Stable Charged Particle Study</title>
<!-- 2015-08-16 Sun 22:38 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Austin Vihncent Skeeters" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js"></script>
<script type="text/javascript">
<!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Heavy Stable Charged Particle Study</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. HSCP Analyais</a>
<ul>
<li><a href="#sec-1-1">1.1. File Generation</a>
<ul>
<li><a href="#sec-1-1-1">1.1.1. Useful Twikis</a></li>
<li><a href="#sec-1-1-2">1.1.2. AOD Files</a></li>
<li><a href="#sec-1-1-3">1.1.3. EDM Files</a></li>
<li><a href="#sec-1-1-4">1.1.4. Usable NTuples</a></li>
<li><a href="#sec-1-1-5">1.1.5. Plots</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-2">2. Playing around with org examples</a></li>
<li><a href="#sec-3">3. Code Snippets</a>
<ul>
<li><a href="#sec-3-1">3.1. Bash script populate array of all files</a></li>
<li><a href="#sec-3-2">3.2. Bash script extract numbers from filename</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> HSCP Analyais</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> File Generation</h3>
<div class="outline-text-3" id="text-1-1">
</div><div id="outline-container-sec-1-1-1" class="outline-4">
<h4 id="sec-1-1-1"><span class="section-number-4">1.1.1</span> Useful Twikis</h4>
<div class="outline-text-4" id="text-1-1-1">
<ul class="org-ul">
<li><a href="https://twiki.cern.ch/twiki/bin/viewauth/CMS/Hscp2014Analysis#Instructions_to_produce_HSCP_sam">https://twiki.cern.ch/twiki/bin/viewauth/CMS/Hscp2014Analysis#Instructions_to_produce_HSCP_sam</a>
</li>
<li><a href="https://twiki.cern.ch/twiki/bin/view/Main/BatchJobs">https://twiki.cern.ch/twiki/bin/view/Main/BatchJobs</a>
</li>
<li><a href="https://twiki.cern.ch/twiki/bin/view/CMSPublic/SWGuideCmsDriver">https://twiki.cern.ch/twiki/bin/view/CMSPublic/SWGuideCmsDriver</a>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1-1-2" class="outline-4">
<h4 id="sec-1-1-2"><span class="section-number-4">1.1.2</span> AOD Files</h4>
<div class="outline-text-4" id="text-1-1-2">
</div><ol class="org-ol"><li><a id="sec-1-1-2-1" name="sec-1-1-2-1"></a>Configuration File Creation<br  /><ol class="org-ol"><li><a id="sec-1-1-2-1-1" name="sec-1-1-2-1-1"></a>Available MC Particle Data<br  /><div class="outline-text-6" id="text-1-1-2-1-1">
<p>
The directory that contains the list of PYTHIA information for the
various available particles is:
<code>/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/Configuration/GenProduction/python/ThirteenTeV/</code>
The list of available files is:
</p>
<table id="AvailablePythiaInfoTable" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="left">Filename</th>
</tr>
</thead>
<tbody>
<tr>
<td class="left">HSCPmchamp12<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp12<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp15<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp15<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp18<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp18<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp1<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp1<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp24<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp24<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp2<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp2<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp30<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp30<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp36<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp36<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>1000</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>100</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>1400</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>1800</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>200</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>2200</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>2600</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>400</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>600</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>800</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp3<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp48<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp48<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp60<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp60<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>1000</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>100</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>1400</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>1800</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>200</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>2200</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>2600</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>400</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>600</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>800</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp6<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp9<sub>M</sub><sub>300</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>

<tr>
<td class="left">HSCPmchamp9<sub>M</sub><sub>900</sub><sub>TuneZ2star</sub><sub>13TeV</sub><sub>pythia6</sub><sub>cff</sub>.py</td>
</tr>
</tbody>
</table>
</div>
</li>

<li><a id="sec-1-1-2-1-2" name="sec-1-1-2-1-2"></a>Creating by Hand<br  /><div class="outline-text-6" id="text-1-1-2-1-2">
<p>
AOD files include all of the information from the simulation. That
is, everything from the detector is included. We do not need all
of this information, and it will get stripped down later. An
example command to create configuration files for the creation of
the AOD files is as follows:
</p>

<pre class="example">
  cmsDriver.py Configuration/GenProduction/python/ThirteenTeV/HSCPmchamp6_M_1400_TuneZ2star_13TeV_pythia6_cff.py --fileout file:mchamp6_M_1400_AOD.root --mc --eventcontent AODSIM --datatier GEN-SIM-DIGI-AOD --conditions MCRUN2_74_V8 --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:GRun,RAW2DIGI,L1Reco,RECO --python_filename mchamp6_M_1400__cfg.py --magField 38T_PostLS1 --geometry Extended2015 --customise SimG4Core/CustomPhysics/Exotica_HSCP_SIM_cfi.customise,SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1 --no_exec -n 10
</pre>
</div>
</li>
<li><a id="sec-1-1-2-1-3" name="sec-1-1-2-1-3"></a>Creating by Automation<br  /><div class="outline-text-6" id="text-1-1-2-1-3">
<p>
Automation of the above has been accomplished by means of a
bash script. This script will create the corresponding
configuration file for the given charge, mass and event number as
specified in the appropriate org code snippet variables available
below in the runner.
</p>
<div class="org-src-container">

<pre class="src src-sh" id="cfg-creator">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>
  <span style="color: #ba5b34;">CHARGE</span>=$<span style="color: #ba5b34;">1</span>
  <span style="color: #ba5b34;">MASS</span>=$<span style="color: #ba5b34;">2</span>
  <span style="color: #ba5b34;">EVENTS</span>=$<span style="color: #ba5b34;">3</span>
  cmsDriver.py Configuration/GenProduction/python/ThirteenTeV/HSCPmchamp${<span style="color: #ba5b34;">CHARGE</span>}_M_${<span style="color: #ba5b34;">MASS</span>}_TuneZ2star_13TeV_pythia6_cff.py --fileout file:mchamp${<span style="color: #ba5b34;">CHARGE</span>}_M_${<span style="color: #ba5b34;">MASS</span>}_AOD.root --mc --eventcontent AODSIM --datatier GEN-SIM-DIGI-AOD --conditions MCRUN2_74_V8 --step GEN,SIM,DIGI,L1,DIGI2RAW,HLT:GRun,RAW2DIGI,L1Reco,RECO --python_filename mchamp${<span style="color: #ba5b34;">CHARGE</span>}_M_${<span style="color: #ba5b34;">MASS</span>}_cfg.py --magField 38T_PostLS1 --geometry Extended2015 --customise SimG4Core/CustomPhysics/Exotica_HSCP_SIM_cfi.customise,SLHCUpgradeSimulations/Configuration/postLS1Customs.customisePostLS1 --no_exec -n ${<span style="color: #ba5b34;">EVENTS</span>}
</pre>
</div>

<p>
The above can be run in the appropriate directory by executing the
following within the Org file:
</p>
<div class="org-src-container">

<pre class="src src-sh" id="cfg-creator-runner">  sh cfgCreator.sh ${<span style="color: #ba5b34;">charge</span>} ${<span style="color: #ba5b34;">mass</span>} ${<span style="color: #ba5b34;">events</span>}
</pre>
</div>
</div>
</li></ol>
</li>
<li><a id="sec-1-1-2-2" name="sec-1-1-2-2"></a>Running Configuration Files<br  /><div class="outline-text-5" id="text-1-1-2-2">
<p>
Once all of these steps, whether by hand or by automation have
been completed, the user should be left with all of the
requested AOD Root files, as well as the left over configuration
files for everything that has been ran.
</p>
</div>
<ol class="org-ol"><li><a id="sec-1-1-2-2-1" name="sec-1-1-2-2-1"></a>Running by Hand<br  /><div class="outline-text-6" id="text-1-1-2-2-1">
<p>
Now, once the appropriate configuration files are created, they
need to be sent to the CERN Batch service to run. The above
cmsDriver command includes all steps including the full
simulation. To send files to the batch service, a script must be
used. An example script is as follows:
</p>

<div class="org-src-container">

<pre class="src src-sh" id="batch-script-example">  <span style="color: #505050;">#</span><span style="color: #505050;">! /bin/sh</span>
  <span style="color: #ba5b34;">CMSSW_PROJECT_SRC</span>=<span style="color: #953331;">"/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/"</span>
  <span style="color: #ba5b34;">CFG_FILE</span>=<span style="color: #953331;">"mchamp6_M_1400_cfg.py"</span>
  <span style="color: #ba5b34;">OUTPUT_FILE</span>=<span style="color: #953331;">"mchamp6_M_1400.root"</span>
  <span style="color: #ba5b34;">TOP</span>=<span style="color: #953331;">"$PWD"</span>

  <span style="color: #385e6b;">cd</span> $<span style="color: #ba5b34;">CMSSW_PROJECT_SRC</span>
  <span style="color: #385e6b;">eval</span> <span style="color: #fa8072;">`scramv1 runtime -sh`</span>
  <span style="color: #385e6b;">cd</span> $<span style="color: #ba5b34;">TOP</span>
  cmsRun $<span style="color: #ba5b34;">CMSSW_PROJECT_SRC</span>/$<span style="color: #ba5b34;">CFG_FILE</span>
  rfcp $<span style="color: #ba5b34;">OUTPUT_FILE</span> $<span style="color: #ba5b34;">CMSSW_PROJECT_SRC</span>$<span style="color: #ba5b34;">OUTPUT_FILE</span>
</pre>
</div>

<p>
After the script is created though, make sure to change the file
permissions with:
</p>
<div class="org-src-container">

<pre class="src src-sh">  chmod 744 lxplusbatchscript.sh
</pre>
</div>

<p>
Now the job(s) must be submitted to the batch service:
</p>
<div class="org-src-container">

<pre class="src src-sh" id="batch-sender-example">  bsub -R <span style="color: #953331;">"pool&gt;30000"</span> -q 1nw -J job1 &lt; lxplusbatchscript.csh
</pre>
</div>
<p>
Where the following options are true: 
</p>
<ul class="org-ul">
<li>"-R" "pool&gt;30000" means that you want a minimum free space of 30GB
</li>
</ul>
<p>
to run your job. 
</p>
<ul class="org-ul">
<li>"-q" 1nw means you are submitting to the 1-week que. Other available
</li>
</ul>
<p>
queues are:
</p>
<ul class="org-ul">
<li>8nm (8 minutes)
</li>
<li>1nh (1 hour)
</li>
<li>8nh
</li>
<li>1nd (1 day)
</li>
<li>2nd (2 days)
</li>
<li>1nw (1 week)
</li>
<li>2nw
</li>
<li>-J job1 sets job1 as your job name
</li>
<li>&lt; lxplusbatchscript.sh gives your script to the job.
</li>
</ul>

<p>
Check your job status with: "bjobs"
Kill jobs with "bkill -J job1"
Using bkill without any job specified will kill ALL of your jobs.
</p>
</div>
</li>

<li><a id="sec-1-1-2-2-2" name="sec-1-1-2-2-2"></a>Running by Automation<br  /><div class="outline-text-6" id="text-1-1-2-2-2">
<p>
All of the aforemntioned can be accomplished automatically by
means of the following scripts:
</p>

<div class="org-src-container">

<pre class="src src-sh" id="batch-creator">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>

  <span style="color: #505050;">#</span><span style="color: #505050;">Populate an array of all of the configuration files</span>
  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_cfg_Files"</span>/* )
  <span style="color: #385e6b;">shopt</span> -u nullglob

  <span style="color: #505050;">#</span><span style="color: #505050;">Create a bash file for each config file</span>
  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #ba5b34;">parts</span>=(${<span style="color: #ba5b34;">file</span>//_/ })
      <span style="color: #ba5b34;">charge</span>=${<span style="color: #ba5b34;">parts</span>[3]}
      <span style="color: #505050;">#</span><span style="color: #505050;">Extract the number from the charge</span>
      <span style="color: #ba5b34;">chargeFixed</span>=$(<span style="color: #fa8072;">echo</span> $<span style="color: #ba5b34;">charge</span> | tr -dc <span style="color: #953331;">'0-9'</span>)
      <span style="color: #ba5b34;">mass</span>=${<span style="color: #ba5b34;">parts</span>[5]}

      <span style="color: #505050;">#</span><span style="color: #505050;">All of the important data has been stripped from the config filename</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">Now to create the bath scripts</span>
      <span style="color: #ba5b34;">filename</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}.sh"</span>
      <span style="color: #ba5b34;">cfgfile</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_cfg.py"</span>
      <span style="color: #ba5b34;">rootfile</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_AOD.root"</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">Create an empty file to be filled</span>
      touch $<span style="color: #ba5b34;">filename</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">Use echo to populate the file contents. Not the cleanest way, but it works for a file this short.</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">"#!/bin/sh"</span>&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'CMSSW_PROJECT_SRC="/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/"'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">"""CFG_FILE='/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_cfg_Files/${cfgfile}'"""</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">"""OUTPUT_FILE='/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_Root_Files/$rootfile'"""</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">"OUT_FILE='$rootfile'"</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'TOP="$PWD"'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'cd $CMSSW_PROJECT_SRC'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'eval `scramv1 runtime -sh`'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'cd $TOP'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'cmsRun $CFG_FILE'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #385e6b;">echo</span> <span style="color: #953331;">'rfcp $OUT_FILE $OUTPUT_FILE'</span>&gt;&gt;$<span style="color: #ba5b34;">filename</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">DO NOT FORGET to change the config file permissions if you are creating these by hand.</span>
      chmod 744 $<span style="color: #ba5b34;">filename</span>
  <span style="color: #909737;">done</span>
</pre>
</div>

<p>
The above places all created files in certain directories that
are expected to remain constant. Should these change, all of the
automation scripts will need to be updated, although the "by
hand" methods will remain independent.
</p>

<p>
After running the batch-creator script, we will have all of the
necessary batch files that we need to run in order to utilize
the appropriate configuration file to produce a corresponding
AOD Root file.
</p>

<div class="org-src-container">

<pre class="src src-sh" id="batch-sender">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>

  <span style="color: #505050;">#</span><span style="color: #505050;">Populate an array of all of the batch scripts </span>
  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_sh_Files"</span>/* )
  <span style="color: #385e6b;">shopt</span> -u nullglob

  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">Strip off the chracters that we dont need</span>
      <span style="color: #ba5b34;">fileFixed</span>=${<span style="color: #ba5b34;">file</span>:17}
      <span style="color: #505050;">#</span><span style="color: #505050;">Send to the two day queue. This can be changed</span>
      bsub -R <span style="color: #953331;">"pool&gt;20000"</span> -q 2nd -J $<span style="color: #ba5b34;">fileFixed</span> &lt; /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_sh_Files/$<span style="color: #ba5b34;">fileFixed</span>
  <span style="color: #909737;">done</span>
</pre>
</div>
</div>
</li></ol>
</li></ol>
</div>

<div id="outline-container-sec-1-1-3" class="outline-4">
<h4 id="sec-1-1-3"><span class="section-number-4">1.1.3</span> EDM Files</h4>
<div class="outline-text-4" id="text-1-1-3">
</div><ol class="org-ol"><li><a id="sec-1-1-3-1" name="sec-1-1-3-1"></a>Creation by Hand<br  /><div class="outline-text-5" id="text-1-1-3-1">
<p>
Once the creation of the AOD files is complete, they need to be
converted into something that is a bit smaller, containing only
the information that we need. Basically, this process involves
cutting out some of the "meat" of the AOD files, reducing their
size, but not (at least for our purposes) their utility.
</p>

<p>
A single file needs to be modified that dictates to cmsRun which
AOD file that you would like to convert to EDM. The file resembles
the following:
</p>

<div class="org-src-container">

<pre class="src src-python">  <span style="color: #909737;">import</span> sys, os
  <span style="color: #909737;">import</span> FWCore.ParameterSet.Config <span style="color: #909737;">as</span> cms
  <span style="color: #505050;">#</span><span style="color: #505050;">Makes EDM from AOD</span>
  <span style="color: #ba5b34;">isSignal</span> = <span style="color: #7f355e;">True</span>
  <span style="color: #ba5b34;">isBckg</span> = <span style="color: #7f355e;">False</span>
  <span style="color: #ba5b34;">isData</span> = <span style="color: #7f355e;">False</span>
  <span style="color: #ba5b34;">isSkimmedSample</span> = <span style="color: #7f355e;">False</span>
  <span style="color: #ba5b34;">GTAG</span> = <span style="color: #953331;">'MCRUN2_74_V8'</span>
  <span style="color: #ba5b34;">OUTPUTFILE</span> = <span style="color: #953331;">'/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_Root_Files/mchamp3_M_400_EDM.root'</span>

  <span style="color: #505050;">#</span><span style="color: #505050;">InputFileList = cms.untracked.vstring()</span>

  <span style="color: #505050;">#</span><span style="color: #505050;">debug input files </span>
  <span style="color: #505050;">#</span><span style="color: #505050;">this list is overwritten by CRAB</span>
  <span style="color: #ba5b34;">InputFileList</span> = cms.untracked.vstring(
      <span style="color: #505050;">#</span><span style="color: #505050;">The comment is an example of how to do this from a remote directory</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">'root://cmseos.fnal.gov//eos/uscms/store/user/aackert/HSCP/AODgen/condorjdls/step2_condortest.root',</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">Below is the file that you want to conver from AOD to EDM</span>
      <span style="color: #953331;">'file:/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_Root_Files/mchamp3_M_400_AOD.root'</span>
  )


  <span style="color: #505050;">#</span><span style="color: #505050;">main EDM tuple cfg that depends on the above parameters</span>
  <span style="color: #385e6b;">execfile</span>( os.path.expandvars(<span style="color: #953331;">'${CMSSW_BASE}/src/SUSYBSMAnalysis/HSCP/test/MakeEDMtuples/HSCParticleProducer_cfg.py'</span>) )
</pre>
</div>

<p>
This file is located at:
<code>/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/MakeEDMtuples/HSCParticleProducer_Signal_cfg.py</code>
</p>

<p>
The lines that need to be altered here are "OUTPUTFILE", and
'file:/afs/cern/ch/&#x2026;' which are basically telling the program
the name of the EDM file that you would like created when the
cmsRun has been ran, and the name of the input file(s). If you
have had to split up a job into multiple smaller files (that is,
you have split up a large AOD into several smaller ones), simply
include the names of each of those files in the "InputFileList",
separated by commas and endlines. It is simply a python array.
</p>

<p>
Once this file has been altered, the conversion is accomplished
simply by running the following:
</p>

<div class="org-src-container">

<pre class="src src-sh">  cmsRun HSCParticleProducer_Signal_cfg.py
</pre>
</div>

<p>
These jobs can also be sent to the batch service if you would
like, however scripts would still need to be created just as with
the AOD files.
</p>
</div>
</li>

<li><a id="sec-1-1-3-2" name="sec-1-1-3-2"></a>Creation by Automation<br  /><div class="outline-text-5" id="text-1-1-3-2">
<p>
All of the aforementioned can be accomplished by means of two
automation scripts. One script, as with the batchCreator script,
is only responsible for the creation of the Python configuration
file dictating the terms of the AOD to EDM conversion. The other,
as is similar again, is responsible for executing the conversion
jobs.
</p>

<div class="org-src-container">

<pre class="src src-sh" id="aod-to-edm-creator">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>

  <span style="color: #505050;">#</span><span style="color: #505050;">Populate an array of all of the AOD files</span>
  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_Root_Files"</span>/*AOD* )
  <span style="color: #385e6b;">shopt</span> -u nullglob

  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #ba5b34;">parts</span>=(${<span style="color: #ba5b34;">file</span>//_/ })
      <span style="color: #ba5b34;">charge</span>=${<span style="color: #ba5b34;">parts</span>[3]}
      <span style="color: #505050;">#</span><span style="color: #505050;">Extract the number from the charge</span>
      <span style="color: #ba5b34;">chargeFixed</span>=$(<span style="color: #fa8072;">echo</span> $<span style="color: #ba5b34;">charge</span> | tr -dc <span style="color: #953331;">'0-9'</span>)
      <span style="color: #ba5b34;">mass</span>=${<span style="color: #ba5b34;">parts</span>[5]}    
      <span style="color: #ba5b34;">aod_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_AOD.root"</span>
      <span style="color: #ba5b34;">root_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_EDM.root"</span>
      <span style="color: #ba5b34;">python_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_cfg.py"</span>

      cat &gt; /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_AODtoEDM_Python_Files/${<span style="color: #ba5b34;">python_file</span>} &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">  import sys, os</span>
<span style="color: #ffff00; font-weight: bold;">  import FWCore.ParameterSet.Config as cms</span>
<span style="color: #ffff00; font-weight: bold;">  #Makes EDM from AOD</span>
<span style="color: #ffff00; font-weight: bold;">  isSignal = True</span>
<span style="color: #ffff00; font-weight: bold;">  isBckg = False</span>
<span style="color: #ffff00; font-weight: bold;">  isData = False</span>
<span style="color: #ffff00; font-weight: bold;">  isSkimmedSample = False</span>
<span style="color: #ffff00; font-weight: bold;">  GTAG = 'MCRUN2_74_V8'</span>
<span style="color: #ffff00; font-weight: bold;">  OUTPUTFILE = '/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_Root_Files/${root_file}'</span>

<span style="color: #ffff00; font-weight: bold;">  InputFileList = cms.untracked.vstring(</span>
<span style="color: #ffff00; font-weight: bold;">  'file:/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_Root_Files/${aod_file}'</span>
<span style="color: #ffff00; font-weight: bold;">  )</span>

<span style="color: #ffff00; font-weight: bold;">  execfile( '${CMSSW_BASE}/src/SUSYBSMAnalysis/HSCP/test/MakeEDMtuples/HSCParticleProducer_cfg.py' )</span>
<span style="color: #ffff00; font-weight: bold;">  EOF</span>

  <span style="color: #909737;">done</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-sh" id="aod-to-edm-runner">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>

  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_Root_Files"</span>/*AOD* )
  <span style="color: #385e6b;">shopt</span> -u nullglob

  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #ba5b34;">parts</span>=(${<span style="color: #ba5b34;">file</span>//_/ })
      <span style="color: #ba5b34;">charge</span>=${<span style="color: #ba5b34;">parts</span>[3]}
      <span style="color: #505050;">#</span><span style="color: #505050;">Extract the number from the charge</span>
      <span style="color: #ba5b34;">chargeFixed</span>=$(<span style="color: #fa8072;">echo</span> $<span style="color: #ba5b34;">charge</span> | tr -dc <span style="color: #953331;">'0-9'</span>)
      <span style="color: #ba5b34;">mass</span>=${<span style="color: #ba5b34;">parts</span>[5]}    
      <span style="color: #ba5b34;">aod_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_AOD.root"</span>
      <span style="color: #ba5b34;">root_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_EDM.root"</span>
      <span style="color: #ba5b34;">python_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_cfg.py"</span>

      <span style="color: #505050;">#</span><span style="color: #505050;">Replace the standard configuration file with the one currently being ran</span>
      cp /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/HSCP_MC_AODtoEDM_Python_Files/${<span style="color: #ba5b34;">python_file</span>} /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/MakeEDMtuples/HSCParticleProducer_Signal_cfg.py
      <span style="color: #385e6b;">cd</span> /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/MakeEDMtuples/
      cmsRun HSCParticleProducer_Signal_cfg.py
      <span style="color: #505050;">#</span><span style="color: #505050;">Don't do the next file until the previous one has ran to completion, as these jobs are not sent to batch</span>
      <span style="color: #385e6b;">wait</span>
  <span style="color: #909737;">done</span>
</pre>
</div>
</div>
</li></ol>
</div>
<div id="outline-container-sec-1-1-4" class="outline-4">
<h4 id="sec-1-1-4"><span class="section-number-4">1.1.4</span> Usable NTuples</h4>
<div class="outline-text-4" id="text-1-1-4">
</div><ol class="org-ol"><li><a id="sec-1-1-4-1" name="sec-1-1-4-1"></a>Creating by Hand<br  /><div class="outline-text-5" id="text-1-1-4-1">
<p>
Once we have EDM files, we are ready to create usable ROOT files
that we can perform analysis on. In order to do so, we have to
call on the Launch.py program located in:
</p>

<p>
<code>/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/AnalysisCode/Launch.py</code>
</p>

<p>
Before calling this though, we must tell Launch which files that
we would like to act on. This is accomplished by editing the
"Analysis<sub>Samples</sub>.txt" file which is located in the same directory
as Launch. An example of this file is as follows:
</p>

<pre class="example">
#RELEASE, SAMPLE TYPE (0=data, 1=bckg, 2=signal, 3=signal systematic), SIGNAL NAME, INPUT FILE NAME, Legend Entry, PILEUP Distribution, Signal Mass, Sample Cross-section, PLOTTING FLAG (0=false, 1=true), Weight for events with 0, 1 and 2 charged HSCP in the event
#HSCP Signal
#"CMSSW_7_4",  2, "MChamp9_13TeV_M900"                , "MChamp9_13TeV_M900"            , "MC: mchamp9 900 GeV/#font[12]{c}^{2}"                     , "S10"   ,    900, +2.5000000000E-03, 1, 1.000, 1.000, 1.000
#
#"CMSSW_7_4",  2, "MChamp6_13TeV_M900"                , "MChamp6_13TeV_M900"            , "MC: mchamp6 900 GeV/#font[12]{c}^{2}"                     , "S10"   ,    900, +2.5000000000E-03, 1, 1.000, 1.000, 1.000
"CMSSW_7_4",   2, "mchamp18_M_300"                    , "mchamp18_M_300_EDM"            , "MC: mchamp6 900 Gev/#font[12]{c}^{2}"                     , "S10"   ,    300, +2.5000000000E-03, 1, 1.000, 1.000, 1.000


#
#
#
#Background
#"CMSSW_7_4", 1, "MC_13TeV_DYToMuMu"                  , "MC_13TeV_DYToMuMu"                     , "MC: DYToMuMu"                            , "S10"   ,      0, +1.3389000000E+03, 0, 0.000, 0.000, 0.000
</pre>

<p>
There are several potential things that could be edited in this
file, but we mainl only need to edit three. The first column
corresponds to the version of CMSSW being used. The second
corresponds to the sample type being read in, where keys and
meanings are displayed at the top of the file. The third column is
the desired name of the output data file once conversion is
complete. The fourth column corresponds to the name of the input
EDM file, with no ".root" extension. The next column is a label
to be used in plots produced by steps two and higher. The next
column "s10" does not need to be changed.This is the type of
pileup distribution. The next column must be changed to equal the
mass of the desired particle in GeV/c<sup>2</sup>. None of the other numbers
need to be changed. It is of course possible to process multiple
files in this step. 
</p>

<p>
In order to produce usable tuples, we must simply run step
one. Step one converts our EDM files to a usable root file. 
Now that the above file has been properly edited, we simply run:
</p>

<div class="org-src-container">

<pre class="src src-sh">  Launch.py 1
</pre>
</div>

<p>
Which will run step 1 of the analysis code. Upon completion, the
data root tuples will be stored in the "Results" folder of the
same directory as Launch. It should be noted that the jobs are
auto-batched to Cern's 2 day queue. 
</p>

<p>
Once can also run the jobs locally by looking in the "FARM/inputs"
folder. You will see ####<sub>HscpAnalysis</sub>.sh where the numbers
correspond to the batched job number. Less them and the bottom
lines will tell you what samples they are running on if you're not
sure. Then just do:
</p>

<div class="org-src-container">

<pre class="src src-sh">  <span style="color: #385e6b;">source</span> filename.sh &gt;&amp; output.txt &amp;
</pre>
</div>

<p>
To run locally (and redirect the output). Running locally is
usually faster than sending to batch, but if the local running
takes longer than two hours, the job will be killed automatically.
</p>
</div>
</li>

<li><a id="sec-1-1-4-2" name="sec-1-1-4-2"></a>Creating by Automation<br  /><div class="outline-text-5" id="text-1-1-4-2">
<p>
The following script will simply populate the
"AnalysisSamples<sub>Gloabal</sub>.txt" file with all of the EDM files that
are available for conversion. Careful with this program though,
as it merely appends to the already existing file. It is best to
delete the contents of the already existing file before running
this in order to avoid the creation of duplicate files. 
</p>

<div class="org-src-container">

<pre class="src src-sh" id="edm-to-ntuple-creator">  <span style="color: #505050;">#</span><span style="color: #505050;">!/bin/bash</span>

  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_Root_Files"</span>/*EDM* )
  <span style="color: #385e6b;">shopt</span> -u nullglob
  <span style="color: #505050;">#</span><span style="color: #505050;">printf "%s\n" "${filearray[@]}"</span>
  <span style="color: #ba5b34;">appendTo</span>=<span style="color: #953331;">"/afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/AnalysisCode/Analysis_Samples.txt"</span>
  <span style="color: #505050;">#</span><span style="color: #505050;">Create a python file for each config file    </span>
  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #ba5b34;">parts</span>=(${<span style="color: #ba5b34;">file</span>//_/ })
      <span style="color: #ba5b34;">charge</span>=${<span style="color: #ba5b34;">parts</span>[3]}
      <span style="color: #505050;">#</span><span style="color: #505050;">Extract the number from the charge</span>
      <span style="color: #ba5b34;">chargeFixed</span>=$(<span style="color: #fa8072;">echo</span> $<span style="color: #ba5b34;">charge</span> | tr -dc <span style="color: #953331;">'0-9'</span>)
      <span style="color: #ba5b34;">mass</span>=${<span style="color: #ba5b34;">parts</span>[5]}    
      <span style="color: #ba5b34;">aod_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_AOD.root"</span>
      <span style="color: #ba5b34;">edm_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}_EDM"</span>
      <span style="color: #ba5b34;">gen_file</span>=<span style="color: #953331;">"mchamp${chargeFixed}_M_${mass}"</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">We need to append to the Analysis_Samples.txt file</span>
      cat &gt;&gt; /afs/cern.ch/work/a/askeeter/private/CMSSW_7_4_4_patch4/src/SUSYBSMAnalysis/HSCP/test/AnalysisCode/Analysis_Samples.txt &lt;&lt; EOF
<span style="color: #ffff00; font-weight: bold;">  "CMSSW_7_4",   2, "$gen_file"    ,"$edm_file"    , "MC: mchamp${chargeFixed} ${mass} GeV/#font[12]{c}^{2}" , "S10", $mass, +9.8480000000E+01, 0, 1.000, 1.000, 1.000</span>
<span style="color: #ffff00; font-weight: bold;">  EOF</span>
  <span style="color: #909737;">done</span>
</pre>
</div>

<p>
Once the list has been populated, the next step is the same as
the above. Simply run:
</p>

<div class="org-src-container">

<pre class="src src-sh" id="launch-Step-1"> Launch.py 1
</pre>
</div>
</div>
</li></ol>
</div>

<div id="outline-container-sec-1-1-5" class="outline-4">
<h4 id="sec-1-1-5"><span class="section-number-4">1.1.5</span> Plots</h4>
<div class="outline-text-4" id="text-1-1-5">
<p>
Step 2 of the analysis code involves generating plots. In order to
run this step, you must simply use the number "2" with Launch.py,
similar to the previous step. However, you must make sure to edit
the file "Analysis<sub>Global</sub>.h" located in the Launch.py directory,
around line 157. Make sure that the "BaseDirectory" points to
where your samples being analyzed are located. Then, you can
simply run step 2 AFTER step 1.
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Playing around with org examples</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-python">  <span style="color: #909737;">import</span> matplotlib, numpy
  <span style="color: #505050;">#</span><span style="color: #505050;">matplotlib.use('Agg')</span>
  <span style="color: #909737;">import</span> matplotlib.pyplot <span style="color: #909737;">as</span> plt
  <span style="color: #ba5b34;">fig</span>=plt.figure(figsize=(4,2))
  <span style="color: #ba5b34;">x</span>=numpy.linspace(-15,15)
  plt.plot(numpy.sin(x)/x)
  fig.tight_layout()
  plt.savefig(<span style="color: #953331;">'/tmp/python-matplot-fig.png'</span>)
  <span style="color: #909737;">return</span> <span style="color: #953331;">'/tmp/python-matplot-fig.png'</span> <span style="color: #505050;"># </span><span style="color: #505050;">return filename to org-mode</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-cpp"><span style="color: #385e6b;">  #include</span> <span style="color: #953331;">&lt;iostream&gt;</span>
  <span style="color: #909737;">using</span> <span style="color: #909737;">namespace</span> <span style="color: #7f355e;">std</span>;
  <span style="color: #909737;">int</span> <span style="color: #385e6b;">main</span>(<span style="color: #909737;">void</span>){
    cout &lt;&lt; <span style="color: #953331;">"Hello world!"</span> &lt;&lt; endl;
    }
</pre>
</div>

<p>
\(-\left<\frac{dE}{dx}\right>=4\pi
        N_{A}r_{e}^2m_{e}c^2z^2\frac{Z}{A}\frac{1}{\beta^2}\left[\frac{1}{2}\ln\frac{2m_ec^2\beta^2\gamma^2T_{max}}{I^2}-\beta^2-\frac{\delta(\beta\gamma)}{2}\right]\times
        Q^2\)
</p>
</div>
</div>




<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Code Snippets</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Bash script populate array of all files</h3>
<div class="outline-text-3" id="text-3-1">
<p>
To populate an array of all of the files in a certain folder you
can do something similar to:
</p>
<div class="org-src-container">

<pre class="src src-sh">  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_sh_Files"</span>/* )
  <span style="color: #385e6b;">shopt</span> -u nullglob
  <span style="color: #505050;">#</span><span style="color: #505050;">Now to loop through them</span>
  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #505050;">#</span><span style="color: #505050;">strip off the characters that we don't need</span>
      <span style="color: #ba5b34;">fileFixed</span>=${<span style="color: #ba5b34;">file</span>:17}
  <span style="color: #909737;">done</span>
</pre>
</div>
<p>
This is what I use in my script that sends jobs to the cern batch
service, as well as my script that creates the batch shell files
based on the available configuration files.
</p>
</div>
</div>
<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Bash script extract numbers from filename</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Similar to the above, we must first obtain a file name that we wish
to parse. So:
</p>
<div class="org-src-container">

<pre class="src src-sh">  <span style="color: #385e6b;">shopt</span> -s nullglob
  <span style="color: #ba5b34;">filearray</span>=( <span style="color: #953331;">"HSCP_MC_cfg_Files"</span>/* )
  <span style="color: #385e6b;">shopt</span> -u nullglob
  <span style="color: #505050;">#</span><span style="color: #505050;">Now to loop through them</span>
  <span style="color: #909737;">for</span> file<span style="color: #909737;"> in</span> <span style="color: #953331;">"${filearray[@]}"</span>
  <span style="color: #909737;">do</span>
      <span style="color: #ba5b34;">parts</span>=(${<span style="color: #ba5b34;">file</span>//_/ })
      <span style="color: #ba5b34;">charge</span>=${<span style="color: #ba5b34;">parts</span>[3]}
      <span style="color: #505050;">#</span><span style="color: #505050;">extract the number from the charge</span>
      <span style="color: #ba5b34;">chargeFixed</span>=$(<span style="color: #fa8072;">echo</span> $<span style="color: #ba5b34;">charge</span> | tr -dc <span style="color: #953331;">'0-9'</span>)
      <span style="color: #ba5b34;">mass</span>=${<span style="color: #ba5b34;">parts</span>[5]}
      <span style="color: #505050;">#</span><span style="color: #505050;">Now we have our relevant info from the file!</span>
  <span style="color: #909737;">done</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Austin Vihncent Skeeters</p>
<p class="date">Created: 2015-08-16 Sun 22:38</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
